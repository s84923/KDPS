<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>スケジュール設定</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        #toast-container {
            position: fixed;
            top: 15px; /* トースト通知を上部に近づける */
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background-color: #000000;
            color: white;
            display: inline-block;
            opacity: 1;
            transition: opacity 0.3s ease-out;
            margin-bottom: 15px;
            text-align: center;
            width: 300px;
            border-radius: 5px;
            padding: 16px;
            font-size: 17px;
        }
    </style>
</head>
<body>
<div class="container">
    {% include 'KDPS/menu.html' %}

    <div class="scheduls-content">
        <h1>スケジュール設定</h1>
        
        <div>
            <a href="?year={{ previous_year }}&month={{ previous_month }}">前の月</a>
            <span>{{ selected_year }}年{{ selected_month }}月</span>
            <a href="?year={{ next_year }}&month={{ next_month }}">次の月</a>
        </div>

        <!-- トースト通知 -->
        <div id="toast-container">
            {% if messages %}
                {% for message in messages %}
                    <div class="toast">{{ message }}</div>
                {% endfor %}
            {% endif %}
        </div>

        <form method="get">
            <label for="year">年の選択</label>
            <select name="year" id="year" onchange="this.form.submit()">
                {% for year in years %}
                    <option value="{{ year }}" {% if year == selected_year %}selected{% endif %}>{{ year }}年</option>
                {% endfor %}
            </select>
            <label for="month">月の選択</label>
            <select name="month" id="month" onchange="this.form.submit()">
                {% for month in months %}
                    <option value="{{ month }}" {% if month == selected_month %}selected{% endif %}>{{ month }}月</option>
                {% endfor %}
            </select>
        </form>

        <table class="calendar">
            <thead>
                <tr>
                    <th style="color:red;">日</th>
                    <th>月</th>
                    <th>火</th>
                    <th>水</th>
                    <th>木</th>
                    <th>金</th>
                    <th style="color:blue;">土</th>
                </tr>
            </thead>
            <tbody>
                {% for week in calendar %}
                    <tr>
                        {% for day in week %}
                            <td>
                                {% if day != 0 %}
                                    {{ day }}
                                    {% for event in schedules %}
                                        {% if event.month == selected_month and event.day == day %}
                                            <div>{{ event.event_name }}</div>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <form method="post">
            {% csrf_token %}
            <label for="month">月の選択</label>
            <select name="month" id="month">
                {% for month in months %}
                    <option value="{{ month }}" {% if month == selected_month %}selected{% endif %}>{{ month }}月</option>
                {% endfor %}
            </select>

            <label for="day">日の選択</label>
            <select name="day" id="day">
                {% for day in days %}
                    <option value="{{ day }}">{{ day }}日</option>
                {% endfor %}
            </select>

            <label for="event_name">イベント</label>
            <input type="text" name="event_name" id="event_name" required>
            <button type="submit">追加</button>
        </form>

        <h2>スケジュール一覧</h2>
        <div class="schedule-list">
            {% for event in schedules %}
                <div>
                    {{ event.month }}月{{ event.day }}日: {{ event.event_name }}
                    <a href="{% url 'delete_schedule' event.id %}">削除</a>
                </div>
            {% empty %}
                <p>スケジュールはありません。</p>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    // トースト通知を3秒後に非表示にする
    setTimeout(function () {
        const toast = document.querySelector('.toast');
        if (toast) {
            toast.style.opacity = '0';  // 透明にする
            setTimeout(function () {
                toast.style.display = 'none';  // 500ms後に完全に非表示
            }, 500);
        }
    }, 3000);
</script>
</body>
</html>
